<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Analysis Results | Interactive Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6cf7;
            --primary-dark: #3b5bdb;
            --secondary-color: #6c757d;
            --secondary-dark: #5a6268;
            --text-color: #333;
            --text-light: #666;
            --light-bg: #f8f9fa;
            --light-blue: #f0f7ff;
            --dark-bg: #343a40;
            --white: #ffffff;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --border-radius: 8px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            
            /* Wave theme colors */
            --sound-wave: #4a6cf7;
            --alpha-wave: #5cb85c;
            --beta-wave: #f0ad4e;
            --delta-wave: #5bc0de;
            --theta-wave: #d9534f;
            --gamma-wave: #9c27b0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            scroll-padding-top: 80px;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
            overflow-x: hidden;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 80px;
            height: 4px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 1.2rem;
            color: var(--primary-dark);
        }
        
        h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
        }
        
        a:hover {
            color: var(--primary-dark);
        }
        
        ul, ol {
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        /* Container */
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 15px;
        }
        
        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 15px 0;
            transition: var(--transition);
        }
        
        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0;
        }
        
        .wave-icon {
            position: relative;
            width: 40px;
            height: 30px;
            margin-right: 10px;
        }
        
        .wave {
            position: absolute;
            width: 100%;
            height: 6px;
            background-color: var(--primary-color);
            border-radius: 10px;
            animation: wave-animation 2s infinite ease-in-out;
        }
        
        .wave:nth-child(1) {
            top: 0;
            animation-delay: 0s;
        }
        
        .wave:nth-child(2) {
            top: 12px;
            animation-delay: 0.2s;
        }
        
        .wave:nth-child(3) {
            top: 24px;
            animation-delay: 0.4s;
        }
        
        @keyframes wave-animation {
            0%, 100% {
                transform: scaleX(1);
            }
            50% {
                transform: scaleX(0.7);
            }
        }
        
        /* Results Section */
        .results-section {
            background-color: var(--white);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .results-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--delta-wave), var(--alpha-wave), var(--beta-wave), var(--theta-wave), var(--gamma-wave));
            opacity: 0.8;
        }
        
        .results-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* Analysis Grid */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 2rem;
        }
        
        /* Analysis Card */
        .analysis-card {
            background-color: var(--light-bg);
            padding: 1.8rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            border-left: 4px solid transparent;
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }
        
        .analysis-card.primary {
            background-color: var(--light-blue);
            border-left-color: var(--primary-color);
        }
        
        .analysis-card h2, .analysis-card h3 {
            position: relative;
            padding-bottom: 0.7rem;
            margin-bottom: 1.2rem;
        }
        
        .analysis-card h2::after, .analysis-card h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 1.5px;
        }
        
        /* Visualization */
        .visualization {
            margin-top: 1.8rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
        }
        
        .visualization:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
        }
        
        .visualization h3 {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 10px 15px;
            margin: 0;
            font-size: 1.1rem;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
        }
        
        .visualization h3::after {
            display: none;
        }
        
        .visualization img {
            display: block;
            max-width: 100%;
            height: auto;
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
            transition: var(--transition);
        }
        
        .visualization:hover img {
            transform: scale(1.02);
            transform-origin: center;
        }
        
        /* Audio Player */
        .audio-player {
            text-align: center;
        }
        
        audio {
            width: 100%;
            max-width: 600px;
            margin: 1.5rem auto;
            border-radius: var(--border-radius);
        }
        
        audio::-webkit-media-controls-panel {
            background-color: var(--light-blue);
        }
        
        audio::-webkit-media-controls-play-button {
            background-color: var(--primary-color);
            border-radius: 50%;
        }
        
        audio::-webkit-media-controls-time-remaining-display, 
        audio::-webkit-media-controls-current-time-display {
            color: var(--text-color);
        }
        
        /* Tags and Labels */
        .ai-tag {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white);
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            margin-left: 10px;
            vertical-align: middle;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .theme-tag {
            display: inline-block;
            background-color: var(--light-bg);
            color: var(--text-color);
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .theme-tag:hover {
            background-color: var(--primary-color);
            color: var(--white);
            transform: translateY(-2px);
        }
        
        /* Back Link */
        .back-link {
            display: inline-flex;
            align-items: center;
            margin-top: 2rem;
            padding: 12px 25px;
            background-color: var(--primary-color);
            color: var(--white);
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 4px 14px rgba(74, 108, 247, 0.4);
        }
        
        .back-link i {
            margin-right: 10px;
        }
        
        .back-link:hover {
            background-color: var(--primary-dark);
            color: var(--white);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(74, 108, 247, 0.6);
        }
        
        /* Understanding Section */
        .understanding-section {
            background-color: var(--white);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .understanding-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background-color: var(--primary-color);
        }
        
        .understanding-section h2 {
            color: var(--primary-dark);
        }
        
        /* Animation for Results Reveal */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .delay-1 {
            animation-delay: 0.2s;
        }
        
        .delay-2 {
            animation-delay: 0.4s;
        }
        
        .delay-3 {
            animation-delay: 0.6s;
        }
        
        .delay-4 {
            animation-delay: 0.8s;
        }
        
        /* Info Box */
        .info-box {
            background-color: var(--light-blue);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: var(--primary-dark);
        }
        
        /* Property Label */
        .property-label {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.6rem;
            }
            
            h3 {
                font-size: 1.3rem;
            }
            
            .results-section, .understanding-section {
                padding: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .analysis-grid {
                gap: 20px;
            }
            
            .analysis-card {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .container {
                width: 95%;
                padding: 1.5rem 10px;
            }
            
            .results-section, .understanding-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <div class="wave-icon">
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                </div>
                <span>WavePerception</span>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 80px;">
        <div class="results-section fade-in">
            <h1>🎧 Analysis Results <span style="font-weight: 400; color: var(--secondary-color);">{{ filename }}</span></h1>
            
            <!-- AI-powered Song Summary -->
            <div class="analysis-card primary fade-in delay-1">
                <h2>AI-Enhanced Song Summary <span class="ai-tag">AI</span></h2>
                <div class="summary-content">
                    <p>{{ song_summary }}</p>
                </div>
            </div>
            
            <div class="analysis-grid">
                <!-- Audio Features -->
                <div class="analysis-card fade-in delay-1">
                    <h2>Audio Wave Features</h2>
                    <div style="background: linear-gradient(135deg, rgba(74,108,247,0.1) 0%, rgba(255,255,255,0.2) 100%); border-radius: var(--border-radius); padding: 1.2rem; margin-bottom: 1.5rem;">
                        <p><span class="property-label">Tempo:</span> {{ audio_analysis.tempo }} BPM</p>
                        <p><span class="property-label">Loudness:</span> {{ audio_analysis.loudness }}</p>
                        <p><span class="property-label">Spectral Centroid:</span> {{ audio_analysis.spectral_centroid }}</p>
                        <p><span class="property-label">Spectral Bandwidth:</span> {{ audio_analysis.spectral_bandwidth }}</p>
                    </div>
                    
                    <div class="info-box">
                        <h3><i class="fas fa-info-circle"></i> Understanding Wave Metrics</h3>
                        <p>These measurements capture the frequency and energy characteristics of the audio waves in your file. Higher spectral centroid values indicate "brighter" sounds with more high-frequency content.</p>
                    </div>
                </div>

                <!-- Visualizations -->
                <div class="analysis-card fade-in delay-2">
                    <h2>Audio Wave Visualizations</h2>
                    <div class="visualization">
                        <h3><i class="fas fa-wave-square"></i> Waveform</h3>
                        <img src="data:image/png;base64,{{ audio_analysis.plots.waveform }}" alt="Waveform Visualization">
                    </div>
                    <div class="visualization">
                        <h3><i class="fas fa-chart-bar"></i> Spectrogram</h3>
                        <img src="data:image/png;base64,{{ audio_analysis.plots.spectrogram }}" alt="Spectrogram Visualization">
                    </div>
                    <div class="visualization">
                        <h3><i class="fas fa-braille"></i> MFCC</h3>
                        <img src="data:image/png;base64,{{ audio_analysis.plots.mfcc }}" alt="MFCC Visualization">
                    </div>
                    {% if audio_analysis.plots.chroma %}
                    <div class="visualization">
                        <h3><i class="fas fa-music"></i> Chromagram</h3>
                        <img src="data:image/png;base64,{{ audio_analysis.plots.chroma }}" alt="Chromagram Visualization">
                    </div>
                    {% endif %}
                </div>

                <!-- Basic Lyrics Analysis -->
                <div class="analysis-card fade-in delay-3">
                    <h2>Lyrics Wave Analysis</h2>
                    <div style="background: linear-gradient(135deg, rgba(92,184,92,0.1) 0%, rgba(255,255,255,0.2) 100%); border-radius: var(--border-radius); padding: 1.2rem; margin-bottom: 1.5rem;">
                        <p><span class="property-label">Sentiment Polarity:</span> {{ lyrics_analysis.sentiment.polarity }}</p>
                        <p><span class="property-label">Sentiment Subjectivity:</span> {{ lyrics_analysis.sentiment.subjectivity }}</p>
                    </div>
                    
                    <h3>Topics</h3>
                    <div>
                        {% for topic in lyrics_analysis.topics %}
                            <span class="theme-tag">{{ topic }}</span>
                        {% endfor %}
                    </div>
                    
                    <h3>Emotions</h3>
                    <div style="background-color: var(--light-bg); padding: 15px; border-radius: var(--border-radius); margin-top: 15px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <strong>{{ lyrics_analysis.emotions[0].label }}</strong>
                            <div style="height: 20px; width: 60%; background-color: #e9ecef; border-radius: 10px; overflow: hidden;">
                                <div style="height: 100%; width: {{ lyrics_analysis.emotions[0].score*100 }}%; background-color: var(--primary-color); border-radius: 10px;"></div>
                            </div>
                            <span>{{ lyrics_analysis.emotions[0].score }}</span>
                        </div>
                    </div>
                </div>

                <!-- AI-Enhanced Lyrics Analysis -->
                {% if lyrics_analysis.ai_analysis %}
                <div class="analysis-card primary fade-in delay-4">
                    <h2>AI-Enhanced Lyrics Analysis <span class="ai-tag">AI</span></h2>
                    
                    <h3>Main Themes</h3>
                    <div>
                        {% for theme in lyrics_analysis.ai_analysis.themes %}
                            <span class="theme-tag">{{ theme }}</span>
                        {% endfor %}
                    </div>
                    
                    <h3>Writing Style</h3>
                    <p>{{ lyrics_analysis.ai_analysis.writing_style }}</p>
                    
                    <h3>Storytelling</h3>
                    <p>{{ lyrics_analysis.ai_analysis.storytelling }}</p>
                    
                    {% if lyrics_analysis.ai_analysis.cultural_references %}
                        <h3>Cultural References</h3>
                        <ul>
                            {% for reference in lyrics_analysis.ai_analysis.cultural_references %}
                                <li>{{ reference }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="understanding-section fade-in delay-2">
            <h2><i class="fas fa-chart-line"></i> Understanding the Visualizations</h2>
            <p>The following visualizations illustrate how different wave frequencies in your audio affect human emotions and perception. These patterns help us analyze the relationship between wave characteristics and psychological impact.</p>
            
            <div class="info-box">
                <h3>Waveform Analysis</h3>
                <p>The waveform shows the amplitude (loudness) of your audio over time. Peaks represent louder moments, while valleys show quieter sections. This visualization helps identify dynamic range and rhythm patterns in the music.</p>
                <p><strong>How to interpret:</strong> More dramatic changes in amplitude often correlate with stronger emotional impacts. Consistent, smooth waveforms tend to create calming effects, while erratic patterns can evoke tension or excitement.</p>
            </div>
        </div>

        <div class="understanding-section fade-in delay-3">
            <h2><i class="fas fa-chart-bar"></i> Spectrogram Insights</h2>
            <p>The spectrogram visualizes the frequency spectrum of the audio signal over time, revealing how different wave frequencies contribute to the overall sound experience.</p>
            
            <div class="info-box">
                <p><strong>How to analyze:</strong> Look for areas of high energy (bright spots) in the graph. These indicate dominant frequencies at specific times, which may trigger particular emotional or perceptual responses:</p>
                <ul>
                    <li>Low frequencies (bottom of chart): Often create a sense of power, warmth, or grounding</li>
                    <li>Mid frequencies (middle): Typically contain vocals and primary melodic content</li>
                    <li>High frequencies (top): Add brightness, clarity, and can influence alertness</li>
                </ul>
            </div>
        </div>

        <div class="understanding-section fade-in delay-4">
            <h2><i class="fas fa-braille"></i> MFCC (Mel-Frequency Cepstral Coefficients)</h2>
            <p>MFCCs represent how humans perceive sound, mapping frequencies to the mel scale which better matches human hearing sensitivity. This helps us understand the timbral qualities that affect perception.</p>
            
            <div class="info-box">
                <p><strong>How to analyze:</strong> The patterns in this visualization represent the "tone color" or timbre of the sound:</p>
                <ul>
                    <li>Consistent horizontal patterns suggest stable tonal qualities</li>
                    <li>Vertical transitions indicate changes in timbre or instrumentation</li>
                    <li>Brighter areas show prominent tonal features that may have stronger perceptual impact</li>
                </ul>
                <p>Research shows that specific MFCC patterns can predict emotional responses with up to 85% accuracy across cultural backgrounds.</p>
            </div>
        </div>

        <!-- Audio Player -->
        <div class="audio-player results-section fade-in delay-4">
            <h2><i class="fas fa-headphones-alt"></i> Uploaded Audio</h2>
            <audio controls>
                <source src="{{ url_for('static', filename='uploads/' + filename) }}" type="audio/mp3">
                Your browser does not support the audio element.
            </audio>
            <p>Listen to your audio again while reviewing the analysis above to make connections between what you hear and what the wave patterns reveal.</p>
        </div>

        <a href="/" class="back-link fade-in delay-4">
            <i class="fas fa-arrow-left"></i> Back to Wave Analysis Tool
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Reveal animations when scrolling
            const revealElements = document.querySelectorAll('.fade-in');
            
            function revealOnScroll() {
                const windowHeight = window.innerHeight;
                
                revealElements.forEach(element => {
                    const elementTop = element.getBoundingClientRect().top;
                    const elementVisible = 150;
                    
                    if (elementTop < windowHeight - elementVisible) {
                        element.style.opacity = "1";
                        element.style.transform = "translateY(0)";
                    }
                });
            }
            
            // Set initial opacity and transform for fade-in elements
            revealElements.forEach(element => {
                element.style.opacity = "0";
                element.style.transform = "translateY(30px)";
                element.style.transition = "opacity 0.6s ease, transform 0.6s ease";
            });
            
            // Initial check on page load
            window.addEventListener('load', revealOnScroll);
            
            // Check on scroll
            window.addEventListener('scroll', revealOnScroll);
        });
    </script>
</body>
</html>